<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>pola by vera — Prediksi vAll</title>
<style>
  :root{
    --bg1:#0f0c29; --bg2:#302b63; --card: rgba(0,0,0,0.6);
    --neon1: #00f6ff; --neon2: #ff00c8; --accent:#ffd700;
  }
  body{
    margin:0; font-family:Inter,Arial,Helvetica,sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#fff; display:flex; align-items:center; justify-content:center; min-height:100vh;
  }
  .app{
    width:920px; max-width:95%; padding:22px; border-radius:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.35));
    box-shadow: 0 6px 40px rgba(0,0,0,0.6), 0 0 40px rgba(0,255,255,0.04);
    display:grid; grid-template-columns: 420px 1fr; gap:18px;
  }
  header{ grid-column:1/-1; display:flex; align-items:center; justify-content:space-between;}
  h1{ margin:0; font-size:20px; letter-spacing:0.6px; color:var(--neon1); text-shadow:0 0 10px rgba(0,246,255,0.12);}
  .logo{ font-weight:800; color:var(--accent)}
  .left, .right { padding:12px; border-radius:10px; background:var(--card); box-shadow: inset 0 0 18px rgba(255,255,255,0.02);}
  label{ display:block; font-size:13px; margin-top:10px; color:#cfd8dc;}
  input[type=number], select{ width:120px; padding:8px 10px; margin-right:8px; border-radius:8px; border:none; background:rgba(255,255,255,0.03); color:#fff; }
  .row{ display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap;}
  button{ padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; color:#000; background:var(--accent); box-shadow:0 6px 18px rgba(0,0,0,0.4);}
  .small { padding:8px 10px; font-size:13px;}
  .muted{ color:#9fb0c6; font-size:13px;}
  .resultBox{ margin-top:12px; padding:12px; border-radius:10px; background:linear-gradient(90deg, rgba(0,0,0,0.25), rgba(255,255,255,0.02)); }
  .pred{ font-size:30px; font-weight:900; letter-spacing:1px; text-shadow:0 0 12px rgba(0,246,255,0.12); }
  .pred.B{ color:#00ff85; }
  .pred.K{ color:#ff6b6b; }
  .prob{ font-size:13px; color:#cfe8df; margin-top:6px; }
  .history{ max-height:420px; overflow:auto; padding:8px; border-radius:8px; background:rgba(0,0,0,0.18); margin-top:12px;}
  .hisRow{ padding:8px; border-bottom:1px dashed rgba(255,255,255,0.03); font-size:13px;}
  .chip{ display:inline-block; padding:6px 8px; border-radius:8px; background:rgba(255,255,255,0.04); margin-right:6px; font-size:12px;}
  .toggles{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;}
  .switch{ display:flex; align-items:center; gap:8px; font-size:13px;}
  .badge{ font-size:12px; padding:6px 8px; border-radius:999px; background:rgba(255,255,255,0.04);}
  footer{ grid-column:1/-1; margin-top:6px; display:flex; justify-content:space-between; font-size:12px; color:#9fb0c6;}
  /* neon effect */
  .neonBox{ box-shadow: 0 0 20px rgba(0,246,255,0.06), inset 0 0 18px rgba(255,0,200,0.02); border:1px solid rgba(255,255,255,0.03); }
  @media(max-width:880px){ .app{ grid-template-columns:1fr; } .left,.right{ order:unset } }
</style>
</head>
<!-- LOGIN PAGE WITH VIDEO BACKGROUND -->
<!-- LOGIN PAGE WITH VIDEO BACKGROUND -->
<div id="loginPage"
  style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  font-family: Inter, sans-serif; z-index:999; overflow:hidden;">

  <video id="bgVideo" autoplay muted loop playsinline
    style="position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:-1;">
    <source src="vera.mp4" type="video/mp4">
  </video>

  <div style="
    width:330px; padding:26px; border-radius:14px; text-align:center;
    background:rgba(0,0,0,0.55); backdrop-filter: blur(8px);
    box-shadow:0 0 25px rgba(0,255,255,0.25), inset 0 0 18px rgba(255,0,255,0.12);
  ">
    <h2 style="margin:0 0 15px; color:#00f6ff;">LOGIN PANEL</h2>

    <input id="loginUser" placeholder="Username" style="width:100%; padding:12px; margin-bottom:10px; border:none; outline:none; border-radius:8px; background:rgba(255,255,255,0.08); color:#fff; text-align:center;">
    <input id="loginPass" placeholder="Password" type="password" style="width:100%; padding:12px; margin-bottom:14px; border:none; outline:none; border-radius:8px; background:rgba(255,255,255,0.08); color:#fff; text-align:center;">

    <button onclick="doLogin()" style="width:100%; padding:12px; border:none; border-radius:10px; font-weight:800; cursor:pointer; background:#ffd700; color:#000;">
      LOGIN
    </button>
    <p id="loginMsg" style="margin-top:10px; color:#ff6b6b; font-size:14px;"></p>
  </div>
</div>
</script>
<body>
  <div class="app neonBox" style="display:none;">
    <header> <button onclick="logout()" style="
  padding:8px 14px; font-size:13px; border:none; border-radius:10px;
  background:#ff6b6b; color:#fff; cursor:pointer;
  box-shadow:0 0 12px rgba(255,0,0,0.4);
">Logout</button>
      <div><h1>POLA GACOR<span class="logo">BY VERA</span> — Prediksi All-in</h1></div>
      <div class="muted">Mode: <span id="modeLabel">Ultra Pro AI</span></div>
    </header>

    <!-- LEFT: controls -->
    <section class="left">
      <label>Zona waktu:</label>
      <div class="row">
        <select id="tz">
          <option value="WIB">WIB (UTC+7)</option>
          <option value="WITA">WITA (UTC+8)</option>
        </select>
        <div class="chip" id="clock">--:--</div>
      </div>

      <label>Input dadu (M1, M2, M3 — M3 optional)</label>
      <div class="row">
        <input id="m1" type="number" min="9" max="54" placeholder="M1">
        <input id="m2" type="number" min="9" max="54" placeholder="M2">
        <input id="m3" type="number" min="9" max="54" placeholder="M3 (opsional)">
      </div>

      <label>Mode & fitur</label>
      <div class="toggles">
        <div class="switch"><input id="ultraAI" type="checkbox" checked> <span>Ultra Pro AI</span></div>
        <div class="switch"><input id="auto5s" type="checkbox"> <span>Auto update 5s</span></div>
        <div class="switch"><input id="deviceLogic" type="checkbox"> <span>Full Device Logic</span></div>
        <div class="switch"><input id="useRacikan" type="checkbox" checked> <span>Pakailah Racikan THIS RX</span></div>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="btnPredict" class="small">Prediksi Sekarang</button>
        <button id="btnClear" class="small">Clear History</button>
      </div>

      <div class="resultBox">
        <div class="muted">Prediksi (deterministik + reason):</div>
        <div id="predLine" class="pred">-</div>
        <div id="probLine" class="prob">Probabilitas: -</div>
        <div id="reason" class="muted" style="margin-top:8px">Alasan: -</div>
      </div>

      <div style="margin-top:12px">
        <div class="muted">Quick rules (fixed-number overrides):</div>
        <div style="margin-top:6px" class="muted">If M==32 → K, M==31→B, 26→B, 29→B, 33→B, 28→K, 34→K, 37→K, 35→B, 22→B, 23→K, 21→K, 24→K, 39→K, 36→K</div>
      </div>
    </section>

    <!-- RIGHT: history & details -->
    <section class="right">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div class="muted">History (terbaru paling atas)</div>
        <div>
          <span class="badge" id="lastAuto">Auto: OFF</span>
          <span class="badge" id="lastUpdate">Last: --</span>
        </div>
      </div>

      <div class="history" id="history"></div>

      <details style="margin-top:12px; color:#cfe8ff; font-size:13px;">
        <summary style="cursor:pointer">Detil pola yang digunakan (klik)</summary>
        <div style="padding:8px; color:#cfe8ff; font-size:13px;">
          <strong>VERA:</strong> tren naik/turun M1→M2→M3.<br>
          <strong>Joe:</strong> jika pola win 2x berturut → ambil lawan (reverse) saat cocok.<br>
          <strong>VERA/REAL:</strong> pakai angka terakhir/majority jika tren tidak konsisten.<br>
          <strong>Racikan THIS VERA:</strong> rentang jam→B/K (digabung dengan pola menit untuk scoring).<br>
          <strong>Device logic:</strong> (opsional) gunakan map menit→B/K per device (jika aktif).
        </div>
      </details>
    </section>

    <footer>
      <div>Engine: Ultra Pro AI + pola gabungan</div>
      <div id="version">v1.0</div>
    </footer>
  </div>

<script>
/* ===========================
   Utility & pattern data
   =========================== */

const historyEl = document.getElementById('history');
const predLine = document.getElementById('predLine');
const probLine = document.getElementById('probLine');
const reasonEl = document.getElementById('reason');
const clockEl = document.getElementById('clock');
const lastUpdateEl = document.getElementById('lastUpdate');
const lastAutoBadge = document.getElementById('lastAuto');

const quickFixed = new Map([
  [32,'K'],[31,'B'],[26,'B'],[29,'B'],[33,'B'],[28,'K'],[34,'K'],[37,'K'],
  [35,'B'],[22,'B'],[23,'K'],[21,'K'],[24,'K'],[39,'K'],[36,'K']
]);

// Racikan THIS RX time ranges (local hours) -> preferred
// We'll map to hours in local tz adjusted for WIB/WITA when evaluating
const racikanRanges = [
  ['00:00','01:00','B'],['01:00','02:30','K'],['02:30','03:00','B'],['03:00','04:00','K'],
  ['04:00','04:50','B'],['04:50','05:30','B'],['05:30','06:15','K'],['06:15','07:30','B'],
  ['07:30','08:30','K'],['08:30','10:00','B'],['10:00','12:00','K'],['12:00','13:00','B'],
  ['13:00','14:00','K'],['14:00','15:00','B'],['15:00','16:30','K'],['16:30','17:50','B'],
  ['17:50','18:55','K'],['18:55','19:30','K'],['19:30','20:00','B'],['20:00','21:00','K'],
  ['21:00','22:00','B'],['22:00','23:00','B'],['23:00','24:00','K']
];

// minute -> map (Google/Chrome rules simplified) used by device logic if enabled
function minuteBucket(min) {
  // from text: various minute buckets; here simplified useful buckets:
  if(min>=0 && min<=6) return 'K';
  if(min>=7 && min<=16) return 'K';
  if(min>=17 && min<=25) return 'B';
  if(min>=26 && min<=36) return 'B';
  if(min>=37 && min<=45) return 'K';
  if(min>=46 && min<=54) return 'B';
  if(min>=55 && min<=59) return 'B';
  return 'K';
}

// device minute bias map (simplified compilation from your data)
const deviceMinuteBias = {
  'IP': (min)=> (min<=30? 'K':'B'),
  'ANDROID': (min)=> (min>=25 && min<=55 ? 'B':'K'),
  'SAMSUNG': (min)=> (min>=0 && min<=30? 'K':'B'), // approximate
  'OPPO': (min)=> (min>=0 && min<=30? 'K':'B'),
  'INFINIX': (min)=> (min>=0 && min<=35? 'K':'B')
};

/* ===========================
   Clock & helpers
   =========================== */

function nowInZone(zone) {
  // zone: 'WIB' or 'WITA'
  let now = new Date();
  // convert UTC then add offset
  let utc = now.getTime() + (now.getTimezoneOffset()*60000);
  let offset = (zone === 'WITA') ? 8 : 7;
  return new Date(utc + (3600000 * offset));
}

function formatHM(dt) {
  return dt.getHours().toString().padStart(2,'0') + ':' + dt.getMinutes().toString().padStart(2,'0');
}

function findRacikanPrediction(timeStr) {
  // timeStr 'HH:MM' local zone string
  // compare with racikanRanges; convert to minutes since midnight
  const [h,m] = timeStr.split(':').map(Number);
  const minutes = h*60 + m;
  for(const [s,e,val] of racikanRanges) {
    const [sh,sm] = s.split(':').map(Number);
    const [eh,em] = e.split(':').map(Number);
    const start = sh*60 + sm;
    const end = (eh===0? 24*60 : eh*60 + em);
    if(minutes >= start && minutes < end) return val;
  }
  return null;
}

/* ===========================
   Scoring & AI engine
   =========================== */

// returns object: {pred: 'B'|'K', prob: 0-100, reason: '...'}
function enginePredict({m1,m2,m3, zone, ultraAI, deviceLogic, useRacikan}) {
  // validation
  m1 = Number(m1); m2 = Number(m2); m3 = (m3 === null || m3 === '')? null: Number(m3);

  // quick fixed-number override
  if(quickFixed.has(m1) && (Math.abs(m1 - m2) <= 0 || m3 === null)) {
    return {pred: quickFixed.get(m1), prob: 92, reason:`Fixed rule for ${m1}`};
  }
  if(quickFixed.has(m2) && (m3 === null || Math.abs(m2 - m1) >= 0)) {
    return {pred: quickFixed.get(m2), prob: 92, reason:`Fixed rule for ${m2}`};
  }
  if(m3 !== null && quickFixed.has(m3)) {
    return {pred: quickFixed.get(m3), prob: 92, reason:`Fixed rule for ${m3}`};
  }

  // base signals
  const signals = []; // each item {label, weight, side: 'B'|'K'}
  // 1) majority small/large
  const vals = [m1,m2]; if(m3!==null) vals.push(m3);
  let countB = vals.filter(v=>v>=32).length;
  let countK = vals.filter(v=>v<=31).length;
  if(countB > countK) signals.push({label:'majority-dice', weight:3, side:'B'});
  else if(countK > countB) signals.push({label:'majority-dice', weight:3, side:'K'});
  else signals.push({label:'tie-majority', weight:1, side: (vals[vals.length-1]>=32?'B':'K')});

  // 2) VERA: trending M1->M2->M3
  let trendScore = 0;
  if(vals.length>=2) {
    for(let i=1;i<vals.length;i++){
      trendScore += (vals[i] > vals[i-1])? 1 : (vals[i] < vals[i-1])? -1 : 0;
    }
  }
  if(trendScore >= 2) signals.push({label:'vera-strong-up', weight:3, side:'B'});
  else if(trendScore <= -2) signals.push({label:'vera-strong-down', weight:3, side:'K'});
  else if(trendScore === 1) signals.push({label:'vera-weak-up', weight:1.5, side:'B'});
  else if(trendScore === -1) signals.push({label:'vera-weak-down', weight:1.5, side:'K'});

  // 3) VERA: if pattern shows 2 same-side in previous (we don't have previous LW stored globally as user didn't supply),
  //    emulate VERA by checking if first two are same side -> consider reverse on next open? We'll implement:
  if(vals.length>=2) {
    const side1 = (vals[0]>=32)?'B':'K';
    const side2 = (vals[1]>=32)?'B':'K';
    if(side1 === side2) {
      // VERA rule: if same twice -> next tends to same but VERA suggests "ambillah lawan" in some notes.
      // We'll add small weight both ways but prefer same (contradictory sources exist), so we add small same weight
      signals.push({label:'joe-repeat', weight:0.6, side:side2});
    }
  }

  // 4) VERA / REAL (take last value bias when uncertain)
  if(trendScore === 0) {
    const lastSide = (vals[vals.length-1] >=32)?'B':'K';
    signals.push({label:'fgus-last', weight:1.2, side:lastSide});
  }

  // 5) Racikan THIS VERA time pattern (if requested)
  const dt = nowInZone(zone);
  const timeStr = formatHM(dt);
  if(useRacikan) {
    const rac = findRacikanPrediction(timeStr);
    if(rac) {
      signals.push({label:'racikan-time', weight:2.2, side: rac});
    }
  }

  // 6) device-minute bias (if device logic enabled) -> but we have no device param from user here in UI (we disabled device earlier)
  //    We'll optionally allow the UI to set a deviceMinute toggle (not requested) -- so implement only if deviceLogic true:
  if(deviceLogic) {
    const minute = dt.getMinutes();
    // pick pseudo-device by asking user? For simplicity, apply minuteBucket
    const mb = minuteBucket(dt.getMinutes());
    signals.push({label:'minute-bucket', weight:1.4, side: mb});
  }

  // Score combine
  let scoreB = 0, scoreK = 0;
  for(const s of signals) {
    if(s.side === 'B') scoreB += s.weight;
    else scoreK += s.weight;
  }

  // Ultra AI: if enabled, apply small smoothing based on difference and number of signals
  let baseConf = Math.abs(scoreB - scoreK);
  // compute probability
  let probB = 50, probK = 50;
  if(scoreB + scoreK > 0) {
    probB = Math.round( (scoreB / (scoreB+scoreK)) * 100 );
    probK = 100 - probB;
  }

  // ultraAI enhancement: consider patterns that historically bias (give small boost)
  if(ultraAI) {
    // boost majority-dice and vera strong
    for(const s of signals) {
      if(s.label==='majority-dice') { if(s.side==='B') probB = Math.min(99, probB + 6); else probK = Math.min(99, probK + 6); }
      if(s.label==='vera-strong-up') probB = Math.min(99, probB + 8);
      if(s.label==='vera-strong-down') probK = Math.min(99, probK + 8);
      if(s.label==='racikan-time') { if(s.side==='B') probB = Math.min(97, probB + 4); else probK = Math.min(97, probK + 4); }
    }
    // normalize
    const total = probB + probK;
    probB = Math.round((probB/total)*100);
    probK = 100 - probB;
  }

  const finalPred = (probB > probK) ? 'B' : 'K';
  const reason = signals.map(s=>`${s.label}(${s.side},w=${s.weight})`).join(', ');

  return {pred: finalPred, prob: probB, reason: reason, signals, timeStr};
}

/* ===========================
   UI logic
   =========================== */

const m1El = document.getElementById('m1');
const m2El = document.getElementById('m2');
const m3El = document.getElementById('m3');
const tzEl = document.getElementById('tz');
const ultraAICheck = document.getElementById('ultraAI');
const auto5sCheck = document.getElementById('auto5s');
const deviceLogicCheck = document.getElementById('deviceLogic');
const useRacikanCheck = document.getElementById('useRacikan');
const btnPredict = document.getElementById('btnPredict');
const btnClear = document.getElementById('btnClear');

let autoTimer = null;
let history = [];

// request notification permission once
if("Notification" in window) {
  Notification.requestPermission().catch(()=>{});
}

function updateClock(){
  const dt = nowInZone(tzEl.value);
  clockEl.innerText = formatHM(dt);
}

// perform one prediction and render
function doPredict(manual=false) {
  updateClock();
  const payload = {
    m1: m1El.value ? Number(m1El.value) : null,
    m2: m2El.value ? Number(m2El.value) : null,
    m3: m3El.value ? Number(m3El.value) : null,
    zone: tzEl.value,
    ultraAI: ultraAICheck.checked,
    deviceLogic: deviceLogicCheck.checked,
    useRacikan: useRacikanCheck.checked
  };
  // require at least m1,m2 present
  if(!payload.m1 || !payload.m2) {
    // skip auto predicts if not filled
    if(manual) {
      alert('Masukkan minimal M1 dan M2 (M3 opsional).');
    }
    return;
  }

  const out = enginePredict(payload);
  // render
  predLine.innerText = out.pred;
  predLine.className = 'pred ' + out.pred;
  probLine.innerText = `Probabilitas B: ${out.prob}%  —  K: ${100 - out.prob}%`;
  reasonEl.innerText = `Alasan: ${out.reason}`;

  // push history (latest top)
  const now = nowInZone(tzEl.value);
  const stamp = formatHM(now);
  const histObj = {time:stamp, m1:payload.m1, m2:payload.m2, m3:payload.m3, pred: out.pred, prob: out.prob, reason: out.reason};
  history.unshift(histObj);
  if(history.length > 200) history.pop();
  renderHistory();

  lastUpdateEl.innerText = `Last: ${stamp}`;
  if(auto5sCheck.checked) lastAutoBadge.innerText = 'Auto: 5s ON'; else lastAutoBadge.innerText = 'Auto: OFF';

  // notification
  if(Notification.permission === "granted" && manual === false) {
    new Notification(`Prediksi: ${out.pred} (${out.prob}%)`);
  } else if(Notification.permission === "granted" && manual === true) {
    new Notification(`Manual Prediksi: ${out.pred} (${out.prob}%)`);
  }
}

function renderHistory() {
  historyEl.innerHTML = '';
  for(const h of history) {
    const div = document.createElement('div');
    div.className = 'hisRow';
    div.innerHTML = `<strong>${h.time}</strong> — M1:${h.m1} M2:${h.m2} ${h.m3? 'M3:'+h.m3 : ''} → <span style="color:${h.pred==='B'? '#00ff85':'#ff6b6b'}; font-weight:800">${h.pred}</span> (${h.prob}%)<div class="muted" style="margin-top:6px;font-size:12px">${h.reason}</div>`;
    historyEl.appendChild(div);
  }
}

// handlers
btnPredict.addEventListener('click', ()=> doPredict(true));
btnClear.addEventListener('click', ()=> { history=[]; renderHistory(); });

// autoupdate toggle
auto5sCheck.addEventListener('change', ()=>{
  if(auto5sCheck.checked) {
    // start interval 5s
    if(autoTimer) clearInterval(autoTimer);
    autoTimer = setInterval(()=> doPredict(false), 5000);
    lastAutoBadge.innerText = 'Auto: 5s ON';
  } else {
    if(autoTimer) clearInterval(autoTimer);
    autoTimer = null;
    lastAutoBadge.innerText = 'Auto: OFF';
  }
});

// clock tick
setInterval(updateClock, 1000);
updateClock();

// small UX: run a predict when UltraAI toggled ON/OFF
ultraAICheck.addEventListener('change', ()=> doPredict(true));
deviceLogicCheck.addEventListener('change', ()=> doPredict(true));
useRacikanCheck.addEventListener('change', ()=> doPredict(true));
tzEl.addEventListener('change', ()=> { updateClock(); doPredict(true); });

// on load: populate with nothing. If user wants demo, can type or we could prefill.
// optional: prefill with example (uncomment to demo):
// m1El.value=35; m2El.value=30; m3El.value='';

/* LOGIN / LOGOUT SYSTEM */
function doLogin(){
  const u = document.getElementById("loginUser").value;
  const p = document.getElementById("loginPass").value;

  if(u === "admin" && p === "vera123"){
    localStorage.setItem("loginVera","true");
    showApp();
  } else {
    document.getElementById("loginMsg").innerText = "Username / Password salah!";
  }
}

function logout(){
  localStorage.removeItem("loginVera");
  showLogin();
}

function showApp(){
  document.getElementById("loginPage").style.display = "none";
  document.querySelector(".app").style.display = "grid";
}

function showLogin(){
  document.getElementById("loginPage").style.display = "flex";
  document.querySelector(".app").style.display = "none";
}

// cek status login saat halaman dibuka
if(localStorage.getItem("loginVera") === "true"){
  showApp();
} else {
  showLogin();
}
</script>
</body>
</html>